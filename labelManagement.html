<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>赛事标签管理</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css" media="all" />
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
		<link rel="stylesheet" href="css/dataTables.jqueryui.min.css" />
		<link rel="stylesheet" href="css/global.css" media="all">
	    <style>
	    	div.search {padding: 30px 0}
	    	.box {
				  position: relative;
				  width: 300px;
				  margin: 0 auto;
				}
	    	input[type="checkbox"]{
	    		width: 30px;
	    		height: 30px;
	    	}
	    	table th{
	    		padding: 9px 15px;
	    		min-height: 20px;]
	    		line-height: 20px;
	    		border: 1px solid #E2E2E2;
	    		font-size: 14px;
	    	}
	    	
			.d7:after {content:"";}
			.d7 .box {
			  width: auto;
			  float: right;
			  margin-right: 30px;
			}
			.d7 input {
			  width: 250px;
			  height: 42px;
			  padding-left: 15px;
			  border-radius: 42px;
			  border: 2px solid #324b4e;
			  /*background: #F9F0DA;*/
			 background: #FFF;
			  outline: none;
			  position: relative;
			  transition: .3s linear;
			}
			.d7 input:focus {
			  width: 300px;
			}
			.d7 button {
			  width: 42px;
			  height: 42px;
			  background: none;
			  border: none;
			  position: absolute;
			  top: -2px;
			  right: 0;
			}
			.d7 button:before{
			  content: "\f002";
			  font-family: FontAwesome;
			  color: #324b4e;
			}
	    </style>
	</head>
	<body>
	   <div class="container" style="width:98%;margin: 0 auto;">	
		 <div style="margin: 15px;">
		      <span class="layui-breadcrumb">
				  <a>赛事</a>
				  <a><cite>赛事标签管理</cite></a>
			  </span>
		 </div>
		 
		 <div class="admin-main">
		 	 <blockquote class="layui-elem-quote">
				<a class="layui-btn" id="add-label">
					添加标签
				</a>
				
				<!--<span class="search d7">
						<div class="box">
						  <input type="text" placeholder="搜索从这里开始..." id="search-area">
						  <button id='search'></button>
						</div>
				</span>-->
				
			</blockquote>
			<fieldset class="layui-elem-field">
				<legend>数据列表</legend>
				<div class="layui-field-box">
				   <div class="tableMarginDiv tableMargin"> 	
					<table class="layui-table admin-table" id="label-table">
						<thead>
							<tr>
								<th>标签</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				   </div>
				</div>
			</fieldset>
		 </div>
		  <script type="text/javascript" src="js/jquery.min.js"></script>
		  <script type="text/javascript" src="plugins/layui/layui.js"></script>
		  <script type="text/javascript" src="js/jquery.dataTables.min.js" ></script>
		 <script type="text/javascript" src="js/com.js"></script>
		 <script>
		 	$(function(){
				     if($(window).width()<767){
				     	 $(".tableMarginDiv").removeClass("tableMargin");
				     	 $(".tableMarginDiv").addClass("table-responsive");
				     }
				     $(window).resize(function(){
				     if($(window).width()<767){
				     	 $(".tableMarginDiv").removeClass("tableMargin");
				     	 $(".tableMarginDiv").addClass("table-responsive");
				     }
				   });
				});
		 </script>
		 <script>
		 	$(function renderEventTableData() {
				        var table = $('#label-table').DataTable({
						"aLengthMenu":[20],
						"searching":false,//禁用搜索
						"lengthChange":false,
						"paging": true,//开启表格分页
						"bProcessing" : true,
						"bServerSide" : true,
						"bAutoWidth" : false,
						"sort" : "position",
						"deferRender":true,//延迟渲染
						"bStateSave" : false, //在第非首页页刷新页面，会自动到第一页
						"iDisplayLength" : 20,
						"iDisplayStart" : 0,
//						"dom": '<l<\'#topPlugin\'>f>rt<ip><"clear">',
						"ordering": false,//全局禁用排序
						
						      /**
						       *     表格注释中文
						       */
						       	    "oLanguage" : { // 国际化配置
							"sProcessing" : "正在获取数据，请稍后...",
							"sLengthMenu" : "显示 _MENU_ 条",
							"sZeroRecords" : "没有找到数据",
							"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
							"sInfoEmpty" : "记录数为_TOTAL_",
							"sInfoFiltered" : "(全部记录数 _MAX_ 条)",
							"sInfoPostFix" : "",
							
							"sUrl" : "",
							"oPaginate" : {
				//				"sFirst" : "第一页",
								"sPrevious" : "<<",
								"sNext" : ">>",
				//				"sLast" : "最后一页"
							}
						},        
						       
						       /*
						        * 
				                *  ajax后台数据，  后台服务器接口写好之后用来请求数据 
				                * 
				                */
				                 
				         
				                
						"ajax": {
				                "type": "POST",
				                "url":　remoteUrl +"platform/projectCategoryServlet.do?flag=getCategoryList3_0_1",
				                 "dataSrc":function(result) {
				                 var list = JSON.parse(JSON.stringify(result));
				                 if(list.notLogin){
				      	           alert("对不起，因为您长时间未操作，服务器已远程断开您的服务，请重新登录帐号");
									window.open("login.html","_top");
								}
				                 return result.categorys;
				                },  
				                "data":function(d){
				                	//数据起始位置，与页码的转换公式。
				                	d.start=(d.start+d.length)/d.length;  
//				                	d.checkStatus = checkStatus;
//				                	d.order = order;
//				                	d.search = $('#search-area').val();
				                }
				        },
				        
				                 /*
						          * 
				                  *  初始化表格数据
				                  * 
				                  */
				
						"aoColumns" : [{
											"mData" : "categoryName",
											"orderable" : false, // 禁用排序
											"sDefaultContent" : "",
				//							"sWidth" : "10%",
											
										},{
											"mData" : "categoryId",
											"orderable" : false, // 禁用排序
											"sDefaultContent" : "",
				//							"sWidth" : "15%",
				                            "render" : function(data, type, full, meta) {
				                               if(full.isShow==true){	
												  return '<a class="layui-btn layui-btn-danger" id="delete-label" data-categoryId='+data+'>&nbsp;删除&nbsp;</a><a class="layui-btn layui-btn-normal" id="hide-label" data-categoryId='+data+'>&nbsp;隐藏&nbsp;</a><a class="layui-btn layui-btn-warm" id="edit-label" data-categoryId='+data+' data-text='+full.categoryName+'>&nbsp;编辑&nbsp;</a>';
											}else{
												 return '<a class="layui-btn layui-btn-danger" id="delete-label" data-categoryId='+data+'>&nbsp;删除&nbsp;</a><a class="layui-btn layui-btn-normal" id="show-label" data-categoryId='+data+'>&nbsp;显示&nbsp;</a><a class="layui-btn layui-btn-warm" id="edit-label" data-categoryId='+data+' data-text='+full.categoryName+'>&nbsp;编辑&nbsp;</a>';
											}
										  }
										}],
						
//							"columnDefs" : 
//										[{
//											"orderable" : false, // 禁用排序
//											"targets" : [0], // 指定的列
//											"data" : "StudentId",
//											"render" : function(data, type, full, meta) {
//												return '<input type="checkbox" value="'+ data + '" name="checkList"/>';
//											}
//										}],
						    /**
					          * 表格加载渲染完毕后执行的方法
					          * @param data
					          */
						
							initComplete:  function initComplete(data){
								
				       },
				       
				       
//						drawCallback: function( settings ) {
//							$("#allChecked").attr("checked", false);//取消全选状态
//					        $("input[name='checkList']").attr("checked", false);//取消全选状态
//					    }
						
					});
						     /**
					          * 表格加载渲染完毕后执行的方法
					          * @param data
					          */
				
				
				
					       /*
					        *    关联全选/取消全选checkbox,给选中行添加selecet样式 便于后面拿数据
					        */
//					     $("#allChecked").on("click", function () {
//				            $("input[name='checkList']").prop("checked",$(this).is(":checked"));
//				//          console.log($(this).prop("checked") );
//				            if($(this).prop("checked")==true){
//				//               console.log($("input[name='checkList']").parent());
//				            	 $("input[name='checkList']").parent().parent().addClass("selected");
//				            }else{
//				            	 $("input[name='checkList']").parent().parent().removeClass("selected");
//				            }
//						});    
					       
						   
//						    $(document).on('keydown','#search-area',function() {
//						    	if(event.keyCode==13){ 
//					      	     table.ajax.reload();
//					      	   }
//						   });
			 layui.use(['layer'], function() {
								var $ = layui.jquery,
								layer = layui.layer;
						
								   //删除标签回调函数
							 	function deleteLabelCallBack(data){
							 		var data = JSON.parse(JSON.stringify(data));
							 		if(!data.notLogin&&data.stateCode==0){
								 		layer.msg('您已成功删除此条标签', {icon: 1});
			                			table.ajax.reload();
							 	    }else if(!data.notLogin&&data.stateCode==1){
							 	    	layer.msg('该标签已使用，您暂不能删除此标签', {icon: 2});
							 	    }else{
							 	    	layer.msg('您还未登录管理员帐户，请先登录。', {icon: 2});
							 	    }
							 	}
							 	   //显示标签回调函数
							 	function showLabelCallBack(data){
							 		var data = JSON.parse(JSON.stringify(data));
							 		if(!data.notLogin&&data.return){
								 		layer.msg('您已成功显示此条标签', {icon: 1});
			                			table.ajax.reload();
							 	    }else if(!data.notLogin&&!data.return){
							 	    	layer.msg('操作失败', {icon: 2});
							 	    }else{
							 	    	layer.msg('您还未登录管理员帐户，请先登录。', {icon: 2});
							 	    }
							 	}
							 	   //隐藏标签回调函数
							 	function hideLabelCallBack(data){
							 	    var data = JSON.parse(JSON.stringify(data));
							 		if(!data.notLogin&&data.return){
								 		layer.msg('您已成功隐藏此条标签', {icon: 1});
			                			table.ajax.reload();
							 	    }else if(!data.notLogin&&!data.return){
							 	    	layer.msg('操作失败', {icon: 2});
							 	    }else{
							 	    	layer.msg('您还未登录管理员帐户，请先登录。', {icon: 2});
							 	    }
							 	}
							 	   //添加标签回调函数
							 	function addLabelCallBack(data){
							 		var data = JSON.parse(JSON.stringify(data));
							 		if(data.return&&data.stateCode==0){
								 		layer.msg('您已成功添加此条标签', {icon: 1});
			                			table.ajax.reload();
							 	    }else if(!data.return&&data.stateCode==1){
							 	    	layer.msg('标签名不能为空', {icon: 2});
							 	    }else{
							 	    	layer.msg('操作失败。', {icon: 2});
							 	    }
							 	}
							 	 	//编辑标签回调函数
							 	function editLabelCallBack(data){
							 		var data = JSON.parse(JSON.stringify(data));
							 		if(data.return&&data.stateCode==0){
								 		layer.msg('您已成功编辑此条标签', {icon: 1});
			                			table.ajax.reload();
							 	    }else if(!data.return&&data.stateCode==1){
							 	    	layer.msg('标签名不能为空', {icon: 2});
							 	    }else if(!data.return&&data.stateCode==2){
							 	    	layer.msg('标签不存在', {icon: 2});
							 	    }else{
							 	    	layer.msg('操作失败。', {icon: 2});
							 	    }
							 	}
						
						
		                        //删除标签
					        $(document).on('click','#delete-label',function() {
					      	     var point = $(this); //获取点击按钮对象
					      	     var postData = {
					      	     	categoryId : point.attr('data-categoryId')
					      	     }
								  layer.confirm('您确定要删除该条标签吗？', {
										  btn: ['确定','取消'] //按钮
										},function(){
										  postRemote("platform/projectCategoryServlet.do?flag=deleteProjectCategory3_0_1", postData , deleteLabelCallBack);
										}, function(){
										});
						   });
                                  //显示标签
                          $(document).on('click','#show-label',function() {
					      	     var point = $(this); //获取点击按钮对象
					      	     var postData = {
					      	     	categoryId : point.attr('data-categoryId'),
					      	     	isShow : 1
					      	     }
								  layer.confirm('您确定要显示该条标签吗？', {
										  btn: ['确定','取消'] //按钮
										},function(){
										  postRemote("platform/projectCategoryServlet.do?flag=getCategoryShow3_0_1", postData , showLabelCallBack);
										}, function(){
										});
						   });
						   
						         //隐藏标签
						    $(document).on('click','#hide-label',function() {
					      	     var point = $(this); //获取点击按钮对象
					      	     var postData = {
					      	     	categoryId : point.attr('data-categoryId'),
					      	     	isShow : 2
					      	     }
								  layer.confirm('您确定要隐藏该条标签吗？', {
										  btn: ['确定','取消'] //按钮
										},function(){
										  postRemote("platform/projectCategoryServlet.do?flag=getCategoryShow3_0_1", postData , hideLabelCallBack);
										}, function(){
										});	
						   });
						         //添加标签
						    $(document).on('click','#add-label',function() {
					      	     var con = '<div style="padding:10px;"><input type="text" class="layui-input" name="categoryName" placeholder="标签名" required lay-verify="required" /></div>';
							     
							      layer.open({
										type: 1,
										title: '添加标签',
										content: con,
										btn: ['确定', '取消'],
										area: ['350px', '175px'],
										yes: function(index, layero) {
											var postData = {
												categoryName: $(layero).find('input[name=categoryName]').val() //标签名
											}
											postRemote("platform/projectCategoryServlet.do?flag=addProjectCategory3_0_1", postData , addLabelCallBack);
                                            layer.close(index);								
										},
										shade :false,
										maxmin :true
									});
						   });
		                   
		                   $(document).on('click','#edit-label',function() {
		                   	     var point = $(this); //获取点击按钮对象
		                   	     var inputText = point.attr('data-text');
					      	     var con = '<div style="padding:10px;"><input type="text" class="layui-input" name="categoryName" placeholder="标签名" required lay-verify="required" value='+inputText+'></div>';
							     
							      layer.open({
										type: 1,
										title: '编辑标签',
										content: con,
										btn: ['确定', '取消'],
										area: ['350px', '175px'],
										yes: function(index, layero) {
											var postData = {
												categoryId : point.attr('data-categoryId'),
												categoryName: $(layero).find('input[name=categoryName]').val() //标签名
											}
											postRemote("platform/projectCategoryServlet.do?flag=updateProjectCategory3_0_1", postData , editLabelCallBack);
                                            layer.close(index);								
										},
										shade :false,
										maxmin :true
									});
									
							});
					 });
						 
				});  
		 </script>
	</body>
</html>
