<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>比赛系数分值设置</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css" media="all" />
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
		<link rel="stylesheet" href="css/dataTables.jqueryui.min.css" />
		<link rel="stylesheet" href="css/global.css" media="all">
		<link rel="stylesheet" href="css/reset.css" media="all">
		<style>
			body {
				font-size: 62.5%;
			}
			
			.layui-form-label {
				font-size: 21px;
			}
			
			.tipspan {
				font-size: 12px;
				color: #CCC;
				margin-left: 0px;
			}
		</style>
	</head>

	<body>
		<div class="container" style="width:98%;margin: 0 auto;">
			<div style="margin: 15px;">
				<span class="layui-breadcrumb">
				  <a>积分管理</a>
				  <a><cite>比赛系数设置</cite></a>
			  </span>
			</div>

			<div class="admin-main">
				<fieldset class="layui-elem-field">
					<legend>数据列表</legend>
					<div class="layui-field-box">
						<div class="tableMarginDiv tableMargin">
							<form class="layui-form">
								<div class="layui-form-item">
									<div class="layui-inline">
										<label class="layui-form-item" style="font-size: 20px;">比赛系数设置</label>
									</div>
								</div>
								<table class="layui-table admin-table" id="factor-table">
									<thead>
										<th style="font-size: 17px;">比赛规模</th>
										<th style="font-size: 17px;">比赛规模系数设置</th>
										<th style="font-size: 17px;">操作</th>
									</thead>
									<tbody>
									</tbody>
								</table>
								</from>
						</div>
					</div>
				</fieldset>
			</div>
			<script type="text/javascript" src="js/jquery.min.js"></script>
			<script type="text/javascript" src="plugins/layui/layui.js"></script>
			<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
			<script type="text/javascript" src="js/com.js"></script>
			<script>
				$(function() {
					if($(window).width() < 767) {
						$(".tableMarginDiv").removeClass("tableMargin");
						$(".tableMarginDiv").addClass("table-responsive");
					}
					$(window).resize(function() {
						if($(window).width() < 767) {
							$(".tableMarginDiv").removeClass("tableMargin");
							$(".tableMarginDiv").addClass("table-responsive");
						}
					});
				});
			</script>
			<script>
				var table;
				$(function renderFactorTableData() {
					table = $('#factor-table').DataTable({
						"aLengthMenu": [20],
						"searching": false, //禁用搜索
						"lengthChange": false,
						"paging": true, //开启表格分页
						"bProcessing": true,
						"bServerSide": true,
						"bAutoWidth": false,
						"sort": "position",
						"deferRender": true, //延迟渲染
						"bStateSave": false, //在第非首页页刷新页面，会自动到第一页
						"iDisplayLength": 20,
						"iDisplayStart": 0,
						//						"dom": '<l<\'#topPlugin\'>f>rt<ip><"clear">',
						"ordering": false, //全局禁用排序

						/**
						 *     表格注释中文
						 */
						"oLanguage": { // 国际化配置
							"sProcessing": "正在获取数据，请稍后...",
							"sLengthMenu": "显示 _MENU_ 条",
							"sZeroRecords": "没有找到数据",
							"sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
							"sInfoEmpty": "记录数为_TOTAL_",
							"sInfoFiltered": "(全部记录数 _MAX_ 条)",
							"sInfoPostFix": "",

							"sUrl": "",
							"oPaginate": {
								//				"sFirst" : "第一页",
								"sPrevious": "<<",
								"sNext": ">>",
								//				"sLast" : "最后一页"
							}
						},

						/*
						 * 
						 *  ajax后台数据，  后台服务器接口写好之后用来请求数据 
						 * 
						 */

						"ajax": {
							"type": "POST",
							"url": 　remoteUrl + "platform/scaleServlet.do?flag=getScaleRatioList3_4_1",
							"dataSrc": function(result) {
								var list = JSON.parse(JSON.stringify(result));
								if(list.notLogin) {
									alert("对不起，因为您长时间未操作，服务器已远程断开您的服务，请重新登录帐号");
									window.open("login.html", "_top");
								}
								return result.data;
							},
							"data": function(d) {
								//数据起始位置，与页码的转换公式。
								d.start = (d.start + d.length) / d.length;
							}
						},

						/*
						 * 
						 *  初始化表格数据
						 * 
						 */

						"aoColumns": [{
							"mData": "scaleName",
							"orderable": false, // 禁用排序
							"sDefaultContent": "",
							//							"sWidth" : "10%",

						}, {
							"mData": "ratio",
							"orderable": false, // 禁用排序
							"sDefaultContent": "",
							//							"sWidth" : "10%",

						}, {
							"mData": "scaleId",
							"orderable": false, // 禁用排序
							"sDefaultContent": "",
							//							"sWidth" : "15%",
							"render": function(data, type, full, meta) {
								return '<a class="layui-btn" id="edit-ratio" data-scaleId=' + data + ' data-ratio=' + full.ratio + '>&nbsp;修改&nbsp;</a>';
							}
						}],

						//							"columnDefs" : 
						//										[{
						//											"orderable" : false, // 禁用排序
						//											"targets" : [0], // 指定的列
						//											"data" : "StudentId",
						//											"render" : function(data, type, full, meta) {
						//												return '<input type="checkbox" value="'+ data + '" name="checkList"/>';
						//											}
						//										}],
						/**
						 * 表格加载渲染完毕后执行的方法
						 * @param data
						 */

						initComplete: function initComplete(data) {

						},

					});
					/**
					 * 表格加载渲染完毕后执行的方法
					 * @param data
					 */

					layui.use(['layer'], function() {
						var $ = layui.jquery,
							layer = layui.layer;

						//修改系数回调函数
						function editRatioCallBack(data) {
							var data = JSON.parse(JSON.stringify(data));
							if(data.notLogin) {
								layer.msg('您还未登录管理员帐户，请先登录。', {
									icon: 2
								});
							} else if(data.return == 1) {
								layer.msg('您已成功修改该系数', {
									icon: 1
								});
								table.ajax.reload();
							} else {
								layer.msg('未知错误', {
									icon: 2
								});
							}
						}

						$(document).on('click', '#edit-ratio', function() {
							var point = $(this); //获取点击按钮对象
							var oldratio = point.attr('data-ratio');
							var con = '<div style="padding:10px;"><input type="text" class="layui-input" name="ratio" placeholder="系数" required lay-verify="required" value=' + oldratio + '></div>';

							layer.open({
								type: 1,
								title: '修改系数',
								content: con,
								btn: ['确定', '取消'],
								area: ['350px', '175px'],
								yes: function(index, layero) {
									var re = /([0-9]+.[0-9]{2})[0-9]*/;
									var postData = {
										scaleId: point.attr('data-scaleId'),
										ratio: $(layero).find('input[name=ratio]').val().replace(re, "$1") //标签名
									}
									if(isNaN(postData.ratio)) {
										layer.msg('必须为数字。', {
											icon: 2
										});
									} else {
										postRemote("platform/scaleServlet.do?flag=setScaleRatio3_4_1", postData, editRatioCallBack);
									}
									                                          layer.close(index);								
								},
								shade: false,
								maxmin: true
							});

						});
					});

				});
			</script>
	</body>

</html>