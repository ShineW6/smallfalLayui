<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>设置权限</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css" media="all" />
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
		<link rel="stylesheet" href="css/dataTables.jqueryui.min.css" />
		<link rel="stylesheet" href="css/global.css" media="all">
		<link rel="stylesheet" href="css/reset.css" media="all">
		<style>
			body{
				font-size: 62.5%;
			}
			.layui-form-label{
				font-size: 21px;
			}
		</style>
	</head>
	<body>
	   <div class="container" style="width:98%;margin: 0 auto;">	
		 <div style="margin: 15px;">
		      <span class="layui-breadcrumb">
				  <a>用户权限</a>
				  <a><cite>设置权限</cite></a>
			  </span>
		 </div>
		 
		 <div class="admin-main">
			<fieldset class="layui-elem-field">
				<legend>数据列表</legend>
				<div class="layui-field-box">
				   <div class="tableMarginDiv tableMargin">
				   	<form class="layui-form">
				   	  <div class="layui-form-item">
				   	    <div class="layui-inline">
					       <label class="layui-form-label">姓名:</label>
					      <div class="layui-input-inline">
					      	<label class="layui-form-label" id="name-label">陈小九</label>
					      </div>
					    </div>
					   </div>
					   <div class="layui-form-item">
					    <div class="layui-inline">
					      <label class="layui-form-label">帐号:</label>
					      <div class="layui-input-inline">
					        <label class="layui-form-label" id="username-label">123456789</label>
					      </div>
					    </div> 
					    </div>	
				  
				<table class="layui-table admin-table" id="userProList-table">
				<thead>
				</thead>
				<tbody id='usertable-Tbody'>
				</tbody>
				</table>
				</from>
				   </div>
				</div>
			</fieldset>
		 </div>
		  <script type="text/javascript" src="js/jquery.min.js"></script>
		  <script type="text/javascript" src="plugins/layui/layui.js"></script>
		  <script type="text/javascript" src="js/jquery.dataTables.min.js" ></script>
		 <script type="text/javascript" src="js/com.js"></script>
		 <script>
		   var adminId,username,name;
		   
		   function setPermissionsCallBack(data,tableLayer){
		   	    var data = JSON.parse(JSON.stringify(data));
		   	    if(data){
		   	    	tableLayer.msg('您已成功修改此权限', {icon: 1});
		   	    }else{
		   	    	tableLayer.msg('未知错误', {icon: 2});
		   	    }
//		   	    if(return){
//						layer.msg('您已成功修改此权限', {icon: 1});
//					}else if(data.stateCode==-999){
//							 	layer.msg('您无权限进行此操作', {icon: 2});
//						}else if(data.notLogin){
//							 	    layer.msg('您还未登录管理员帐户，请先登录。', {icon: 2});
//							}
		   }
		   
		   function renderPermissions(data,obj){
		   	    var permissions = JSON.parse(JSON.stringify(data.permissions));
		   	    var tableLayer = obj.layer;
		   	    var tableForm = obj.form;
		   	    var tbodyDom = '';
		   	    for(var i=0;i<permissions.length;i++){
		   	    	
                    if(permissions[i].hasPermission){
                    	
                     if(i%2==0){
                     	tbodyDom += '<tr>';
                     	tbodyDom += '<td>'+permissions[i].permissionName+':</td>';
                      	tbodyDom += '<td><div class="layui-form-item swichPro" data-permissionCode='+permissions[i].permissionCode+' data-permissionId='+permissions[i].permissionId+' data-hasPermission='+permissions[i].hasPermission+'><input type="checkbox" name='+permissions[i].permissionCode+' lay-skin="switch" lay-text="允许|禁止" checked></td>';
                     }else{
                     	tbodyDom += '<td>'+permissions[i].permissionName+':</td>';
                      	tbodyDom += '<td><div class="layui-form-item swichPro" data-permissionCode='+permissions[i].permissionCode+' data-permissionId='+permissions[i].permissionId+' data-hasPermission='+permissions[i].hasPermission+'><input type="checkbox" name='+permissions[i].permissionCode+' lay-skin="switch" lay-text="允许|禁止" checked></td>';
                     	tbodyDom += '</tr>'
                     }
                    
                    }else{
                      
	                     if(i%2==0){
	                     	tbodyDom += '<tr>';
	                     	tbodyDom += '<td>'+permissions[i].permissionName+':</td>';
	                      	tbodyDom += '<td><div class="layui-form-item swichPro" data-permissionCode='+permissions[i].permissionCode+' data-permissionId='+permissions[i].permissionId+' data-hasPermission='+permissions[i].hasPermission+'><input type="checkbox" name='+permissions[i].permissionCode+'  lay-skin="switch" lay-text="允许|禁止"></td>';
	                     }else{
	                     	tbodyDom += '<td>'+permissions[i].permissionName+':</td>';
	                      	tbodyDom += '<td><div class="layui-form-item swichPro" data-permissionCode='+permissions[i].permissionCode+' data-permissionId='+permissions[i].permissionId+' data-hasPermission='+permissions[i].hasPermission+'><input type="checkbox" name='+permissions[i].permissionCode+'  lay-skin="switch" lay-text="允许|禁止"></td>';
	                     	tbodyDom += '</tr>'
                         }
                      
                    }
                    
		   	    }
		   	    
		   	   $('#usertable-Tbody').html(tbodyDom);
		   	   tableForm.render();
		   	   
		   	   $(document).on('click', '.layui-unselect.layui-form-switch',function() {
		   	   	   var iStatus;//权限状态
		   	   	   var point = $(this).closest(".layui-form-item.swichPro");  
		   	   	   var permissionId = point.attr("data-permissionId");   //权限id
		   	   	   if($(this).hasClass("layui-form-onswitch")){
		   	   	   	  iStatus = 1;
		   	   	   }else{
		   	   	   	  iStatus = 2;
		   	   	   }
		   	   	   postRemote("platform/permissionServlet.do?flag=setAdminPermission3_0_1",{"adminId":adminId,"permissionId":permissionId,"hasPermission":iStatus},setPermissionsCallBack,tableLayer);
		   	   });
		   }
		   
		   function getUserPermissions(){
		 		layui.use(['layer', 'form'], function() {
				var layer = layui.layer,
					$ = layui.jquery,
					form = layui.form();
					
					$('#name-label').text(name);
					$('#username-label').text(username);
					postRemote("platform/permissionServlet.do?flag=getAdminPermission3_0_1", {"adminId":adminId}, renderPermissions,{"layer":layer,"form":form});
			    });
		 	}
		   
		   
           $(function pageInit() {
            	
            var request = getRequest();
            adminId = request["adminId"] == null ? "" : request["adminId"];
            username = request["username"] == null ? "" : request["username"];
            name = request["name"] == null ? "" : request["name"];
            
            getUserPermissions();
            
         });
        
		 	
			
        </script>
	</body>
</html>
