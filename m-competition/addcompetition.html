<!DOCTYPE html>
<html>
<head>
    <title>十步芳草 - 发布赛事</title>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="www.keyweb.cn" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no;" />
    <link href="../m-files/bootstrap.css" rel="stylesheet" />
    <link href="../m-files/style.css" rel="Stylesheet" />
    <link href="../m-files/mobiscroll.css" rel="Stylesheet" />
    <link href="../m-files/mobiscroll_date.css" rel="Stylesheet" />
    <script type="text/javascript" src="../m-files/config.js"></script>
    <script type="text/javascript" src="../m-files/jquery.min.js"></script>
    <script type="text/javascript" src="../m-files/bootstrap.js"></script>
    <script type="text/javascript" src="../m-files/mobiscroll_date.js"></script>
    <script type="text/javascript" src="../m-files/mobiscroll.js"></script>
    <script type="text/javascript" src="../m-files/uploadPicture/mobileBUGFix.mini.js"></script>
    <script type="text/javascript" src="../m-files/uploadPicture/uploadImage.js"></script>
    <script type="text/javascript" src="../m-files/exif.js"></script>
    <script type="text/javascript" src="../m-files/jquery.rotate.min.js"></script>
</head>
<body class="competition grayBg">
    <div class="competitionBackPositionBox wexinBar" style="background:#f0f0f0">
        <a href="javascript:window.history.go(-1)" class="back"></a>
    </div>
    <div id="addCompetitionBox" class="addCompetitionBox weixinPadding">
        <form id="addCompetitionForm">
            <div class="item">
                <div class="title">赛事名称</div>
                <div class="content"><input type="text" id="compeName" name="compeName" /></div>
            </div>
            <div class="item">
                <input type="hidden" id="compeLongitude" name="compeLongitude" value="" />
                <input type="hidden" id="compeLatitude" name="compeLatitude" value="" />
                <div class="title">举办地点</div>
                <div class="content" style="position:relative"><span class="addressTxtImg" onclick="showMapAddressModal()"></span><input type="text" id="compeAddress" name="compeAddress" /></div>
            </div>
            <div class="item">
                <div class="title">报名时间</div>
                <div class="content" style="width:1.2rem;margin:0;padding:0"><input id="compeEnterStart" name="compeEnterStart" type="text" style="background:none;margin:0;padding:0"></div>
                <div class="title" style="width:0.3rem;padding:0;text-align:left">至</div>
                <div class="content" style="width:1.2rem;"><input id="compeEnterEnd" name="compeEnterEnd" type="text" style="background:none;margin:0;padding:0"></div>
            </div>
            <div class="item">
                <div class="title">竞赛时间</div>
                <div class="content" style="width:1.2rem;margin:0;padding:0"><input id="compeStartTime" name="compeStartTime" type="text" style="background:none;margin:0;padding:0"></div>
                <div class="title" style="width:0.3rem;padding:0;text-align:left">至</div>
                <div class="content" style="width:1.2rem;"><input id="compeEndTime" name="compeEndTime" type="text" style="background:none;margin:0;padding:0"></div>
            </div>
            <div class="item projectCategoryBox">
                <div class="title">标<span style="visibility:hidden">空空</span>签</div>
                <div class="content">
                    <div class="btn-group" data-toggle="buttons" id="projectCategoryBox"></div>
                </div>
            </div>
            <div style="margin-top:0.1rem;border-bottom:1px solid #ccc;overflow:hidden"></div>
            <div class="item">
                <div class="title" style="width:auto;text-indent:0.15rem">赛事主办方<img src="../m-files/ss-introdution.jpg" style="height:0.25rem" onclick="showZBFModal()" /></div>
                <!-- 赛事主办方模态框（Modal） -->
                <div class="modal fade" id="ZBFModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border:0px;">
                            <div class="modal-header" style="border:0px;text-align:center">
                                <h4 class="modal-title" id="myModalLabel" style="">赛事主办方</h4>
                            </div>
                            <div class="modal-body" style="padding-top:0.05rem;padding-bottom:0;margin:0">
                                <textarea id="compeSponsor" name="compeSponsor" placeholder="请输入内容（100字以内）" maxlength="100" style="width:100%;height:1.8rem;border:0; outline:none;background:#f9f9f9;padding:5px;"></textarea>
                            </div>
                            <div class="modal-footer" style="text-align: center;border:0px;">
                                <button type="button" class="btn btn-primary" data-dismiss="modal" style="width:1.5rem;background:#2ec0b7;border:0;border-radius:20px;">完成</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="item">
                <div class="title" style="width:auto;text-indent:0.15rem">赛事承办方<img src="../m-files/ss-introdution.jpg" style="height:0.25rem" onclick="showCBFModal()" /></div>
                <!-- 赛事承办方模态框（Modal） -->
                <div class="modal fade" id="CBFModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border:0px;">
                            <div class="modal-header" style="border:0px;text-align:center">
                                <h4 class="modal-title" id="myModalLabel" style="">赛事承办方</h4>
                            </div>
                            <div class="modal-body" style="padding-top:0.05rem;padding-bottom:0;margin:0">
                                <textarea id="compeCoSponsor" name="compeCoSponsor" placeholder="请输入内容（100字以内）" maxlength="100" style="width:100%;height:1.8rem;border:0; outline:none;background:#f9f9f9;padding:5px;"></textarea>
                            </div>
                            <div class="modal-footer" style="text-align: center;border:0px;">
                                <button type="button" class="btn btn-primary" data-dismiss="modal" style="width:1.5rem;background:#2ec0b7;border:0;border-radius:20px;">完成</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="margin-top:0.1rem;border-bottom:1px solid #ccc;overflow:hidden"></div>
            <div class="item">
                <div class="title" style="width:auto;text-indent:0.15rem">赛事介绍描述<span>（2000字以内）</span><img src="../m-files/ss-introdution.jpg" style="height:0.25rem" onclick="showIntrodutionModal()" /></div>
                <!-- 赛事介绍描述模态框（Modal） -->
                <div class="modal fade" id="introdutionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border:0px;">
                            <div class="modal-header" style="border:0px;text-align:center">
                                <h4 class="modal-title" id="myModalLabel" style="">赛事介绍描述</h4>
                            </div>
                            <div class="modal-body" style="padding-top:0.05rem;padding-bottom:0;margin:0">
                                <textarea id="compeIntroduction" name="compeIntroduction" placeholder="请输入内容（2000字以内）" maxlength="2000" style="width:100%;height:1.8rem;border:0; outline:none;background:#f9f9f9;padding:5px;"></textarea>
                            </div>
                            <div class="modal-footer" style="text-align: center;border:0px;">
                                <button type="button" class="btn btn-primary" data-dismiss="modal" style="width:1.5rem;background:#2ec0b7;border:0;border-radius:20px;">完成</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="item">
                <input type="hidden" id="projectPic" name="projectPic" />
                <div class="title" style="width:auto;text-indent:0.15rem">赛事海报<img src="../m-files/ss-pictures.jpg" style="height:0.25rem" onclick="showPictureModal()" /></div>
                <!-- 封面图片模态框（Modal） -->
                <div class="modal fade" id="pictureModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border:0px;">
                            <div class="modal-header" style="border:0px;text-align:center">
                                <h4 class="modal-title" id="myModalLabel" style="">赛事海报</h4>
                            </div>
                            <div class="modal-body" style="padding-top:0.05rem;padding-bottom:0;margin:0">
                                <div id="cutImgBox" style="border:2px solid #333;position:absolute;background:rgba(0, 0, 0, 0.3);display:none;z-index:99999"></div>
                                <input type="file" id="picture" name="picture" style="display:none" accept="image/*" />
                                <div id="pictureBox" style="width:100%;height:auto;overflow:hidden; border:0; outline:none;background:#f9f9f9;line-height:1.8rem;font-size:1rem;color:#ccc;font-weight:normal;text-align:center">+</div>
                            </div>
                            <div class="modal-footer" style="text-align: center;border:0px;">
                                <button type="button" class="btn btn-primary" style="width:1.5rem;background:#2ec0b7;border:0;border-radius:20px;" onclick="openSelectPictureWindow()">选择图片</button>
                                <button type="button" id="uploadBtn" class="btn btn-primary" style="width:1.5rem;background:#2ec0b7;border:0;border-radius:20px;" onclick="doUploadPicture()">完成</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="item">
                <div class="title">开通报名</div>
                <div class="content"><div class="switch" style="background:#fff;height:0.3rem;padding-top:0.06rem;float:right;margin-right:0.25rem"><input type="checkbox" id="checkbox-8-4" name="isEnter" checked /><label for="checkbox-8-4"></label></div></div>
            </div>
            <div class="item">
                <div class="title" style="width:auto;text-indent:0.15rem">赛事网站地址<img src="../m-files/ss-introdution.jpg" style="height:0.25rem" onclick="showRecruitModal()" /></div>
                <!-- 赛事网站地址模态框（Modal） -->
                <div class="modal fade" id="recruitModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content" style="border:0px;">
                            <div class="modal-header" style="border:0px;text-align:center">
                                <h4 class="modal-title" id="myModalLabel" style="">赛事网站地址</h4>
                            </div>
                            <div class="modal-body" style="padding-top:0.05rem;padding-bottom:0;margin:0">
                                <textarea id="compeURL" name="compeURL" placeholder="请输入赛事网站地址" style="width:100%;height:1.8rem;border:0; outline:none;background:#f9f9f9;padding:5px;"></textarea>
                            </div>
                            <div class="modal-footer" style="text-align: center;border:0px;">
                                <button type="button" class="btn btn-primary" data-dismiss="modal" style="width:1.5rem;background:#2ec0b7;border:0;border-radius:20px;">完成</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="moreBox" style="border:0;background-color:#eaeaea;z-index:999">
        <input class="btn btn-primary" type="button" onclick="saveProject()" value="提交" />
    </div>
    <!-- 登录模态框（Modal） -->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form action="user/loginRegisterServlet.do?flag=login3_0_1" method="post" id="loginForm">
                <div class="modal-content" style="border:0px;">
                    <div class="modal-header" style="">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel" style="">登录</h4>
                    </div>
                    <div class="modal-body">
                        <label class="inputLabel" for="userName">用户名</label><input type="text" id="userName" name="userName" placeholder="请输入用户名" />
                        <label class="inputLabel" for="password">密码</label><input type="password" id="password" name="password" placeholder="请输入密码" />
                        <div class="rememberBox"><input type="checkbox" id="rememberPassword" name="rememberPassword" checked="checked" /><label for="rememberPassword">记住密码</label></div>
                    </div>
                    <div class="modal-footer" style="text-align: center;">
                        <button type="button" class="btn btn-primary loginBtn" onclick="doLogin()">登录</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!--地图-->
    <div id="mapAddressModal">
        <iframe src="" style="overflow:hidden"></iframe>
    </div>
    <script type="text/javascript" src="../m-files/com.js"></script>
    <script type="text/javascript">
        function showMapAddressModal() {
            $("#mapAddressModal iframe").attr("src", "addmap.html?lng=" + $("#compeLongitude").val() + "&lat=" + $("#compeLatitude").val());
            $("#mapAddressModal").show();

            $("#mapAddressModal iframe").css("height", $(window).height() + "px");

        }

        function cancelAddress() {
            $("#mapAddressModal").hide();
        }

        function setAddress(address, lng, lat) {
            $("#mapAddressModal").hide();
            $("#compeLongitude").val(lng);
            $("#compeLatitude").val(lat)
        }

        //封面图片上传
        function openSelectPictureWindow() {
            $("#picture").click();
        }

        $("#picture").change(function () {
            // if (!this.files[0].type.match('image/*')) {
            //     showMsg("只能上传图片！", "error");
            //    return;
            // }

            if (this.files[0].size / 1024 > 7120) {
                showMsg("图片不能大于7120kb！", "error");
                return;
            }

            var objUrl = getObjectURL(this.files[0]);
            //alert("objUrl = " + objUrl);
            if (objUrl) {
                $("#pictureBox").html("<img src=''>");
                $("#cutImgBox").css("display", "none");
                selectFileImage(this, "#pictureBox img");
            }
        });

        function cutImg() {
            var img = document.createElement('img');
            img.src = $("#pictureBox img").attr("src");

            var w = img.width < img.height ? img.width : img.height;

            var sc = img.width < img.height ? img.width / $("#pictureBox img").width() : img.height / $("#pictureBox img").height();

            var x = ($('#cutImgBox').position().left - $('#pictureBox img').position().left) * sc;
            var y = ($('#cutImgBox').position().top - $('#pictureBox img').position().top) * sc;

            var canvas = document.createElement("canvas");
            var ctx = canvas.getContext("2d");
            canvas.width = w;
            canvas.height = w;

            ctx.drawImage(img, x, y, w, w, 0, 0, w, w);

            var base64 = null;
            base64 = canvas.toDataURL("image/jpeg", 0.8);
            $("#pictureBox img").attr("src", base64);

            $("#cutImgBox").css("display", "none");
        }

        function doUploadPicture() {
            if ($("#cutImgBox").css("display") != "none") {
                cutImg();
            }

            if ($("#pictureBox img").attr("src") == null) {
                showMsg("请上传封面图片！", "error");
                return;
            }

            $("#pictureModal #uploadBtn").html("上传中...");
            $("#pictureModal #uploadBtn").attr("disabled", true);
            var formData = new FormData();
            var imageData = $("#pictureBox img").attr("src");
            formData.append("picture", convertBase64UrlToBlob(imageData), "image.jpeg");

            $.ajax({
                url: remoteUrl + "student/projectServlet.do?flag=uploadPicture",
                data: formData,
                type: "POST",
                responseType: 'blob',
                dataType: "json",
                processData: false,         // 告诉jQuery不要去处理发送的数据
                contentType: false,        // 告诉jQuery不要去设置Content-Type请求头
                cache: false,
                success: function (result) {
                    $("#pictureModal #uploadBtn").html("完成");
                    $("#pictureModal #uploadBtn").attr("disabled", false);
                    if (result.stateCode == -1) {
                        showMsg("上传失败！", "error");
                    } else if (result.stateCode == -2) {
                        showMsg("文件过大，不能超过5120kb！", "error");
                    } else if (result.stateCode == 1) {
                        showMsg("用户名不能为空！", "error");
                    } else if (result.stateCode == 0) {
                        $("#pictureModal").modal("hide");
                        var str = result.picUrl;
                        $("#projectPic").val(str.substring(str.lastIndexOf("/") + 1));
                        showMsg("上传成功！", "success");
                    } else {
                        showMsg("未知错误！", "error");
                    }
                },
                timeout: 60000, // 超时设置,如果60秒内请求无响应,则执行error定义的方法
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (textStatus == "timeout")
                        showMsg("网络连接超时", "error");
                    else if (XMLHttpRequest.status == 0)
                        showMsg("网络连接错误", "error");
                    else
                        showMsg("服务器异常：" + XMLHttpRequest.status, "error");

                    $("#pictureModal #uploadBtn").html("完成");
                    $("#pictureModal #uploadBtn").attr("disabled", false);
                }
            });
        }

        var _x_start, _y_start, _x_move, _y_move, _x_end, _y_end, left_start, top_start;
        document.getElementById("cutImgBox").addEventListener("mousedown", function (e) {
            _x_start = event.pageX;
            _y_start = event.pageY;
            // console.log("start",_x_start)
            top_start = $("#cutImgBox").css("top");
            left_start = $("#cutImgBox").css("left");
        });

        document.getElementById("cutImgBox").addEventListener("mousemove", function (e) {
            _x_move = event.pageX;
            _y_move = event.pageY;
            // console.log("move",_x_move)
            if ($("#pictureBox img").width() < $("#pictureBox img").height()) {
                //下移
                if ($('#cutImgBox').position().top < parseFloat(_y_move) - parseFloat(_y_start) + parseFloat(top_start)) {
                    if ($('#cutImgBox').position().top + $("#pictureBox img").width() < $('#pictureBox img').position().top + $("#pictureBox img").height())
                        $("#cutImgBox").css("top", parseFloat(_y_move) - parseFloat(_y_start) + parseFloat(top_start) + "px");
                } else if ($('#cutImgBox').position().top > parseFloat(_y_move) - parseFloat(_y_start) + parseFloat(top_start)) {
                    if ($('#cutImgBox').position().top > $('#pictureBox img').position().top)
                        $("#cutImgBox").css("top", parseFloat(_y_move) - parseFloat(_y_start) + parseFloat(top_start) + "px");
                }
            } else {
                //左移
                if ($('#cutImgBox').position().left > parseFloat(_x_move) - parseFloat(_x_start) + parseFloat(left_start)) {
                    if ($('#cutImgBox').position().left > $('#pictureBox img').position().left)
                        $("#cutImgBox").css("left", parseFloat(_x_move) - parseFloat(_x_start) + parseFloat(left_start) + "px");
                } else if ($('#cutImgBox').position().left < parseFloat(_x_move) - parseFloat(_x_start) + parseFloat(left_start)) {
                    if ($('#cutImgBox').position().left + $("#pictureBox img").height() < $('#pictureBox img').position().left + $("#pictureBox img").width())
                        $("#cutImgBox").css("left", parseFloat(_x_move) - parseFloat(_x_start) + parseFloat(left_start) + "px");
                }
            }
            //console.log(parseFloat(_y_move) - parseFloat(_y_start) + parseFloat(top_start));
        });

        document.getElementById("cutImgBox").addEventListener("mouseup", function (e) {
            var _x_end = event.pageX;
            var _y_end = event.pageY;
            // console.log("end",_x_end)
        });


        //保存赛事
        function saveProject() {


            if ($("#compeName").val() == "") {
                showMsg("赛事名称不能为空！", "error");
                return;
            }



            if ($("#compeEnterStart").val() == "") {
                showMsg("报名开始时间不能为空！", "error");
                return;
            }
            if ($("#compeEnterEnd").val() == "") {
                showMsg("报名结束时间不能为空！", "error");
                return;
            }

            if ($("#cutImgBox").css("display") != "none" || $("#pictureBox img").attr("src") == null) {
                showMsg("请上传海报图片！", "error");
                return;
            }

            var compeEnterStartStr = $("#compeEnterStart").val();
            var compeEnterStart = new Date(compeEnterStartStr.replace(/-/, "/"));

            var compeEnterEndStr = $("#compeEnterEnd").val();
            var compeEnterEnd = new Date(compeEnterEndStr.replace(/-/, "/"));

            if (compeEnterStart - compeEnterEnd > 0) {
                showMsg("报名开始时间不能大于结束时间！", "error");
                $("#compeEnterStart").focus();
                return;
            }

            if ($("#compeStartTime").val() == "") {
                showMsg("赛事开始时间不能为空！", "error");
                return;
            }
            if ($("#compeEndTime").val() == "") {
                showMsg("赛事结束时间不能为空！", "error");
                return;
            }
            var compeStartTimeStr = $("#compeStartTime").val();
            var compeStartTime = new Date(compeStartTimeStr.replace(/-/, "/"));

            var compeEndTimeStr = $("#compeEndTime").val();
            var compeEndTime = new Date(compeEndTimeStr.replace(/-/, "/"));

            if (compeStartTime - compeEndTime > 0) {
                showMsg("赛事开始时间不能大于结束时间！", "error");
                $("#compeStartTime").focus();
                return;
            }

            if ($("#compeAddress").val() == "") {
                showMsg("举办地点不能为空！", "error");
                return;
            }

            if ($("#compeLongitude").val() == "") {
                showMsg("请选择竞赛地点地图坐标！", "error");
                return;
            }

            if ($("#compeIntroduction").val() == "") {
                showMsg("赛事介绍描述不能为空！", "error");
                return;
            }
            if ($("input[name='projectPic']").val() == "") {
                showMsg("封面图片不能为空！", "error");
                return;
            }

            //if ($("#compeURL").val() != "" && $("#compeURL").val().indexOf("http") != 0) {
            //    showMsg("赛事官网网址请填写完整！", "error");
            //    return;
            //}

            $(".moreBox .btn").val("提交中...");
            $(".moreBox .btn").attr("disabled", true);
            postRemote("company/competitionServlet.do?flag=publishCompetition2_2_1", {
                compeCategory: $("#projectCategoryBox .active input").val(),
                compeName: $("input[name='compeName']").val(),
                compeEnterStart: $("input[name='compeEnterStart']").val(),
                compeEnterEnd: $("input[name='compeEnterEnd']").val(),
                compeStartTime: $("input[name='compeStartTime']").val(),
                compeEndTime: $("input[name='compeEndTime']").val(),
                compeAddress: $("input[name='compeAddress']").val(),
                compeLongitude: $("input[name='compeLongitude']").val(),
                compeLatitude: $("input[name='compeLatitude']").val(),
                compePicture: $("input[name='projectPic']").val(),
                compeSponsor: $("#compeSponsor").val(),
                compeCoSponsor: $("#compeCoSponsor").val(),
                compeIntroduction: $("#compeIntroduction").val(),
                compeURL: $("#compeURL").val(),
                isEnter: $("input[name='isEnter']").is(':checked') == true ? 1 : 0
            }, saveProjectCallback);
        }

        function backToList() {
            //window.history.go(-1);
            document.referrer === '' ? window.location.reload() : window.history.go(-1);
        }

        function saveProjectCallback(result) {
            $(".moreBox .btn").val("提交");
            $(".moreBox .btn").attr("disabled", false);
            if (result.stateCode == 0) {
                showMsg("提交成功！", "success");
                console.log(result);
                setTimeout(backToList, 500);
                return;
            } else if (result.stateCode == 1) {
                showMsg("未登录！", "error");
                return;
            } else if (result.stateCode == 2) {
                showMsg("信息不能为空！", "error");
                return;
            } else if (result.stateCode == 3) {
                showMsg("保存失败！", "error");
                return;
            } else if (result.stateCode == 4) {
                showMsg("企业未认证！", "error");
                return;
            } else if (result.stateCode == 5) {
                showMsg("报名时间不在参赛时间之前！", "error");
                return;
            } else if (result.stateCode == 6) {
                showMsg("开始时间不能大于结束时间！", "error");
                return;
            } else {
                showMsg("未知错误：stateCode=" + result.stateCode, "error");
                return;
            }
        }

        function showZBFModal() {
            $("#ZBFModal").modal("show");
        }

        function showCBFModal() {
            $("#CBFModal").modal("show");
        }

        function showIntrodutionModal() {
            $("#introdutionModal").modal("show");
        }

        function showJobModal() {
            $("#jobModal").modal("show");
        }

        function showRecruitModal() {
            $("#recruitModal").modal("show");
        }

        function showPictureModal() {
            $("#pictureModal").modal("show");
            $('#pictureModal').on('mousemove', function (event) { event.preventDefault(); });
        }

        $(function () {
            var currYear = (new Date()).getFullYear();
            var opt = {};
            opt.date = {
                preset: 'date'
            };
            opt.datetime = {
                preset: 'datetime'
            };
            opt.time = {
                preset: 'time'
            };
            opt.default = {
                theme: 'android-ics light', //皮肤样式
                display: 'modal', //显示方式
                mode: 'scroller', //日期选择模式
                dateFormat: 'yyyy-mm-dd',
                lang: 'zh',
                showNow: true,
                nowText: "今天",
                startYear: currYear - 10, //开始年份
                endYear: currYear + 10 //结束年份
            };
            $("#compeEnterStart").mobiscroll($.extend(opt['date'], opt['default']));
            $("#compeEnterEnd").mobiscroll($.extend(opt['date'], opt['default']));
            $("#compeStartTime").mobiscroll($.extend(opt['datetime'], opt['default']));
            $("#compeEndTime").mobiscroll($.extend(opt['datetime'], opt['default']));
        });

        //取得实践经历基本参数（类型、标签y）
        function getProjectBaseInfo() {
            postRemote("user/seekEluationServlet.do?flag=getProjectBaseInfo2_2_1", {}, getProjectBaseInfoCallback);
        }
        function getProjectBaseInfoCallback(result) {
            var activeForms = result.activeForms;
            var html = "";
            for (var i = 0; i < activeForms.length; i++) {
                html += "<label class='btn btn-type active' name='" + activeForms[i].formName + "'><input checked type='radio' name='activeForm' value='" + (i + 1) + "'>" + activeForms[i].formName + "</label>";
            }
            $("#activeFormsBox").html(html);

            var projectCategory = result.projectCategory;
            var html1 = "";
            for (var j = 0; j < projectCategory.length; j++) {
                if (j == 0) {
                    html1 += "<label class='btn btn-tag active' style='border-radius:3px'><input checked type='radio' name='compeCategory' value='" + projectCategory[j].formId + "'>" + projectCategory[j].formName + "</label>";
                } else {
                    html1 += "<label class='btn btn-tag' style='border-radius:3px'><input type='radio' name='compeCategory' value='" + projectCategory[j].formId + "'>" + projectCategory[j].formName + "</label>";
                }
            }
            $("#projectCategoryBox").html(html1);

        }

        //必须登录
        mustLogin = true;
        //页面初始化
        function pageInit() {
            getProjectBaseInfo();
            setIframe();
        }
        function setIframe() {
//          var w = $("body").width();
            //var h = $(".moreBox").offset().top + $(".moreBox").height();alert(h)
            var w = window.screen.availWidth;
            var h = window.screen.availHeight;
            $("#mapAddressModal").css("top", "0px");
            $("#mapAddressModal").css("width", w + "px");
            $("#mapAddressModal").css("height", h + "px");

            $("#mapAddressModal iframe").css("width", w + "px");
            $("#mapAddressModal iframe").css("height", h + "px");
        }
        $(window).resize(function () {
            setIframe();
        });
    </script>
</body>
</html>
